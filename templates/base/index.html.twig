{% extends 'base.html.twig' %}
{% block title %}
	{{ parent() }}
	Accueil
{% endblock %}

{% block body %}

{# Container de la page contenant la partie de gauche et de droite #}

<div class="container d-flex mt-5 mb-5">
	{# Colonne de gauche #}
	<div class="col-md-8 me-1 h-100">
		{# Première div de gauche (présentation) #}
		<div class="p-3" style="background-color:rgba(31, 41, 55); border-radius: 16px;">
			<p>Bonjour à tous,</p>
			<p>Nous sommes Sullivan, Thoma et Paul, trois étudiants du BTS SIO (Services Informatiques aux Organisations) au sein du lycée Guy Mollet à Arras.</p>
			<p>Nous sommes ravis de vous présenter notre projet actuel, qui incarne notre engagement envers l'informatique et notre créativité. Pour l'occasion du Salon de l'Étudiant 2023, nous avons développé un jeu de dames en ligne. Ce jeu classique est désormais accessible à tous, à partir de n'importe quel appareil connecté à Internet. Notre objectif était de créer une expérience ludique et conviviale tout en démontrant nos compétences en développement web et en conception de jeux.</p>
			<p>Nous vous invitons à venir découvrir notre projet au Salon de l'Étudiant 2023. Notre équipe sera présente pour vous montrer en direct notre jeu de dames en ligne, discuter de nos réalisations et de nos ambitions futures, et répondre à toutes vos questions. Nous sommes impatients de partager notre passion pour la technologie et l'informatique avec vous.</p>
		</div>
		{# Deuxième div de gauche (rejoindre ou inviter) #}
		<div class="p-3 mt-2" style="background-color:rgba(31, 41, 55); border-radius: 16px;">
			<div class="text-center">
				<h3 class="text-white"><i class="bi bi-people"></i> Party Mode</h3>
			</div>
			<div class="text-center">
				<p>Jouez avec vos amis grâce au lien d'invitation</p>
				{% if app.user %}
					<form action="{{path('creation-partie')}}">
						<button type="submit" style="outline: none;" class="btn btn-outline-info">Créer une partie</button>
					</form>
				{% else %}
					<button type="button" style="outline: none;" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#creerPartieModal">Créer une partie</button>
				{% endif %}
				<p>Ou</p>
				<h4 class="text-white">Rejoindre une partie</h4>
				{% if app.user %}
					<div class="d-inline-block rounded-3 p-1 bg-white">
						<input class="me-1 inputJoinParty" type="text" id="joinPartyForm" placeholder="Code de la partie">
						<button class="btnJoinParty" type="submit" id="joinPartyButton">Rejoindre</button>
					</div>
				{% else %}
					<div class="d-inline-block rounded-3 p-1 bg-white">
						<input class="me-1 inputJoinParty" type="text" placeholder="Code de la partie">
						<button type="button" style="outline: none;" class="btnJoinParty" data-bs-toggle="modal" data-bs-target="#creerPartieModal">Rejoindre</button>
					</div>
				{% endif %}
			</div>
		</div>
	</div>
	{# Colonne de droite #}
	<div class="col-md-4 ms-1 flex-grow-1">
		<div class="d-flex flex-column h-100">
			{% if app.user %}
				<div class="p-3" style="background-color: rgba(31, 41, 55); border-radius: 16px;">
					<div class="text-center">
						<p class="m-0 mb-2 text-white">{{ app.user.username }}</p>
					</div>
					<div class="d-flex">
						<div class="text-center me-2">
							<img class="img-fluid" src="images/profile.jpeg"/>
						</div>
						<div class="d-flex flex-column justify-content-between flex-grow-1">
							<div class="text-white p-1 border border-white rounded-2 mt-0 p-2">
								<span>Rang : <span style="color:{{ app.user.rang.couleur }};">{{ app.user.rang.libelle }}</span></span>
								<img class="img-fluid mx-auto" src="images/rangs/{{ app.user.rang.miniLogo }}"/>
							</div>
							<div class="text-white p-1 border border-white rounded-2 mt-0 p-2">
								<span>Monnaie : {{ app.user.monnaie }}
									<i class="bi bi-coin text-warning"></i>
								</span>
							</div>
						</div>
					</div>
					<div>
						<p>Nombre de partie(s) : {{ app.user.nbTotalePartie }}</p>
						<p>Nombre de victoire(s) / défaite(s) : {{ app.user.nbVictoire }} / {{ app.user.nbDefaite }}</p>
					</div>
				</div>
			{% else %}
				<div class="p-3" style="background-color: rgba(31, 41, 55); border-radius: 16px;">
					<div class="text-center">
						<p class="m-0 mb-2 text-white">Vous devez vous connecter.</p>
					</div>
					<div class="d-flex">
						<div class="text-center me-2">
							<img class="img-fluid" src="images/profile.jpeg"/>
						</div>
						<div class="d-flex flex-column justify-content-between flex-grow-1">
							<div class="text-white p-1 border border-white rounded-2 mt-0 p-2">
								<span>Rang : Non disponible</span>
							</div>
							<div class="text-white p-1 border border-white rounded-2 mt-0 p-2">
								<span>Monnaie : Non disponible</span>
							</div>
						</div>
					</div>
					<div class="text-center mt-3">
						<a href="{{ path('app_login') }}" class="align-self-center">
							<button class="btn text-white" style="background-color: #6d28d9;">Connexion</button>
						</a>
					</div>
				</div>
			{% endif %}
			<div class="p-3 mt-2 h-100" style="background-color:rgba(31, 41, 55); border-radius: 16px;">
				<h3 class="text-center text-white mb-3">Top joueurs</h3>
				{% for joueur in joueurs %}
					<div class="mx-3 d-flex justify-content-between">
						<p style="margin: 0;">{{ joueur.username }}</p>
						<p style="margin: 0;">Rang : <img class="img-fluid" src="images/rangs/{{ joueur.rang.miniLogo }}"/></p>
					</div>
					<hr>
				{% endfor %}
				<div class="text-center mt-3">
					<a type="button" style="outline: none;" class="btn btn-outline-info" href="{{path('classement')}}">Voir le classement</a>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal -->
	<div class="modal fade" id="creerPartieModal" tabindex="-1" aria-labelledby="creerPartieModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h1 class="modal-title fs-5" id="creerPartieModalLabel">Information</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					Vous devez vous connecter pour créer ou rejoindre une partie.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
					<a href="{{ path('app_login') }}" class="align-self-center">
						<button class="btn text-white" style="background-color: #6d28d9;">Connexion</button>
					</a>
				</div>
			</div>
		</div>
	</div>



<script>
	document.addEventListener('DOMContentLoaded', function () {
    const joinPartyButton = document.getElementById('joinPartyButton');
    const joinPartyInput = document.getElementById('joinPartyForm');

    joinPartyButton.addEventListener('click', function () {
        const codePartie = joinPartyInput.value;
        // Effectuez une vérification asynchrone pour savoir si la partie existe.
        checkIfPartieExists(codePartie);
    });

    function checkIfPartieExists(codePartie) {
    // Vous devez implémenter une requête asynchrone pour vérifier si la partie existe.
    fetch(`https://s3-4674.nuage-peda.fr/damier/public/partie/${codePartie}`)
        .then(response => {
            if (response.status === 200) {
                // La partie existe, redirigez l'utilisateur vers la page de la partie.
                window.location.href = `https://s3-4674.nuage-peda.fr/damier/public/partie/${codePartie}`;
            } else {
                // La partie n'existe pas, faites quelque chose en conséquence (par exemple, affichez un message d'erreur).
                console.log('La partie n\'existe pas.');
            }
        })
        .catch(error => {
            console.error('Erreur lors de la vérification de la partie : ', error);
        });
}
});
</script>

{% endblock %}
